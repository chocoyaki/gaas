%****************************************************************************%
%* DIET User's Manual description chapter file                              *%
%*                                                                          *%
%*  Author(s):                                                              *%
%*    - Philippe COMBES (Philippe.Combes@ens-lyon.fr)                       *%
%*                                                                          *%
%* $LICENSE$                                                                *%
%****************************************************************************%
%* $Id$
%* $Log$
%* Revision 1.17  2006/12/02 15:47:22  ycaniou
%* Re. minus 2 URLs web access et problem descriptions.
%*
%* Revision 1.16  2006/12/02 12:01:18  ycaniou
%* Some modifications: lecture terminée pour cette partie
%*
%* Revision 1.15  2006/09/11 11:15:00  ycaniou
%* - Up to date documentation for parallel/batch submission
%* - Corrected wrong references
%*
%* Revision 1.14  2006/05/12 12:12:32  sdahan
%* Add some documentation about multi-MA
%*
%* Bug fix:
%*  - segfault when the neighbours configuration line was empty
%*  - deadlock when a MA create a link on itself
%*
%* Revision 1.13  2006/02/17 00:22:01  ecaron
%* Ready to release 2.1.0
%*
%* Revision 1.12  2006/01/25 16:52:55  pfrauenk
%* CoRI : renaming of the chapter performance prediction with fast
%* 	to performance prediction, add of the CoRI Usersmanual,
%* 	changes in the plugin scheduler
%*
%* Revision 1.11  2005/06/27 19:26:52  hdail
%* - Moved introduction to FAST to description section with intro to multi-MA and
%*   gave both chapter references.
%* - Changed version number to 2.0.
%* - Moved info on compiling FAST itself to fast section from install section.
%*   install section still explains how to configure DIET with FAST.
%*
%* Revision 1.10  2005/06/24 14:27:07  hdail
%* Correcting english problems & updating descriptions that are no longer true.
%*
%* Revision 1.9  2005/06/14 08:05:40  ecaron
%* FAST decribe as an example
%*
%* Revision 1.8  2005/06/01 07:28:43  alsu
%* errant letter removed!
%*
%* Revision 1.7  2005/06/01 07:21:35  alsu
%* fixing a figure labeling problem
%*
%* Revision 1.6  2005/05/29 13:51:22  ycaniou
%* Moved the section concerning FAST from description to a new chapter about FAST
%* and performances prediction.
%* Moved the section about convertors in the FAST chapter.
%* Modified the small introduction in chapter 1.
%* The rest of the changes are purely in the format of .tex files.
%*
%* Revision 1.5  2004/10/25 08:59:56  sdahan
%* add the multi-MA documentation
%****************************************************************************%

\chapter{A DIET platform}
\label{ch:description}

\textsc{Diet} is built upon \emph{Server Daemons}. The process of
scheduling the requests is distributed amongst a hierarchy of
\emph{Local Agents} and \emph{Master Agents}. The scheduler can use
resource availability information collected from three different
tools: from NWS~\cite{WSH99} sensors which are placed on every node of
the hierarchy, from the application-centric performance prediction
tool \textsc{FAST} \cite{Qui02}, which relies on NWS information, or
from CoRI Easy, which is based on simple system calls and some basic
performance tests (see Chapter~\ref{chapter:performance}).
Figure~\ref{fig:platform} shows the hierarchical organization of
\textsc{Diet}.

\begin{figure}[htb]
 \begin{center}
  \resizebox{.7\linewidth}{!}{\includegraphics{fig/global_platform.eps}}
  \caption{\label{fig:platform}A hierarchy of \textsc{Diet} agents}
 \end{center}
\end{figure}

%====[ \textsc{Diet} components ]=======================================================
\section{DIET components}
\label{sec:components}

The different components of our software architecture are the following:

\begin{description}
%....[ Client ]................................................................
\item \textbf{Client}\\ A client is an application which uses
  \textsc{Diet} to solve problems.  Many types of clients are able to
  connect to \textsc{Diet}, from a web page, a PSE such as Matlab or
  \sci, or from a compiled program.
%....[ Master Agent (MA) ].....................................................
\item \textbf{Master Agent (MA)}\\ An MA receives computation requests
  from clients. These requests refer to some \textsc{Diet} problems
  listed on a reference web page. Then the MA collects computation
  abilities from the servers and chooses the best one. The reference
  of the chosen server is returned to the client. A client can be
  connected to an MA by a specific name server or a web page which
  stores the various MA locations.

%....[ Local Agent (LA) ]......................................................
\item \textbf{Local Agent (LA)}\\ An LA transmits requests and
  information between MAs and servers.  The information stored on an
  LA is the list of services available in the subtree rooted at the
  LA; for each service, LAs store a list of children (agents or
  servers) that can be contacted to find the service. Depending on the
  underlying network topology, a hierarchy of LAs may be deployed
  between an MA and the servers. Of course, the function of an LA is
  to do a partial scheduling on its subtree, which reduces the
  workload at the MA.

%....[ Server Daemon (SeD) ]...................................................
\item \textbf{Server Daemon (SeD)}\\ A SeD encapsulates a
  computational server. For instance it can be located on the entry
  point of a parallel computer. The information stored on a SeD is a
  list of the data available locally ({\it i.e.}, on the server), the
  list of problems that can be solved on it, and performance-related
  information such as the amount of available memory or the number of
  resources available. When it registers, a SeD declares the problems
  it can solve to its parent LA or MA.  A SeD can give perfomance and
  hardware information by using the module CoRI or performance
  predictions for some types of problems by using the module FAST.
  Both modules are described in chapter~\ref{chapter:performance}.

\end{description}

%\begin{figure}[htb]
% \begin{center}
%  \resizebox{.6\linewidth}{!}{\includegraphics{fig/global_platform.eps}}
%  \label{fig:platform}
%  \caption{A hierarchy of \textsc{Diet} agents}
% \end{center}
%\end{figure}

%====[ CORBA ]=================================================================
\section{Communications layer}
\label{sec:CORBA}

NES environments can be implemented using a classic socket
communication layer.  Several problems to this approach have been
pointed out such as the lack of portability or limits on the number of
sockets that can be opened concurrently.  Our aim is to implement and
deploy a distributed NES environment that works at a wider
scale. Distributed object environments, such as \emph{Java},
\emph{DCOM} or CORBA have proven to be a good base for building
applications that manage access to distributed services. They not only
provide transparent communications in heterogeneous networks, but they
also offer a framework for the large scale deployment of distributed
applications. Being open and language independent, CORBA was chosen as
the communication layer in \textsc{Diet}.

As recent implementations of CORBA provide communication times close to
that of sockets, CORBA is well suited to support distributed
applications in a large scale Grid environment. New specialized
services can be easily published and existing services can also be
used.  \textsc{Diet} is based upon \emph{OmniORB 3}~\cite{OMNIORB} or later,
a free CORBA implementation that provides good communication
performance.



%====[ DIET INITIALIZATION ]===================================================
\section{DIET initialization}
\label{init}

Figure~\ref{fig:init} shows each step of the initialization of a
simple Grid system. The architecture is built in hierarchical order,
each component connecting to its parent. The MA is the first entity to
be started~(1). It waits for connections from LAs or requests from
clients.

\begin{figure}[hbt]
  \begin{center}
    \resizebox{9cm}{!}{\includegraphics{fig/init.eps}}
    \caption{Initialization of a \textsc{Diet} system.}
    \label{fig:init}
  \end{center}
\end{figure}

In step (2), an LA is launched and registers itself with the MA.
At this step of system initialization, two kinds of components can
connect to
the LA: a \sed ~(3), which manages some computational resource, or
another LA~(4), to add a hierarchical level in this branch. When the
\sed\ registers to its parent LA, it submits a list of the services it
offers.  The agent then reports the new service offering through its
parent agent until the MA.  If the service was previously unavailable
along that arm of the hierarchy the agents update their records.
Finally, clients can access the registered service by contacting
the MA~(5) to get a reference to the best server available and then
directly connect to it to launch the computation.

The architecture of the hierarchy is described in configuration files
(see Section~\ref{sec:diet_config_files})
and each component transmits the local configuration to its
parent. Thus, the system administration can also be hierarchical. For
instance, an MA can manage a domain like a university, providing
prioritary access to users of this domain. Then each laboratory can
run an LA, while each team of the laboratory can run some other LAs to
administrate its own servers. This hierarchical administration of the
system allows local changes in the configuration without interfering
with the whole platform.



%====[ Solving a problem ]=====================================================
\section{Solving a problem}
\label{sec:solvepb}

Assuming that the architecture described in Section
~\ref{sec:components} includes several servers able to solve the
same problem, the algorithm presented below lets an MA select a
server for the computation among those available. This decision is
made in four steps.


%%%%%%%%%%%%%%%
%% FIXME for DIET v1.1
%%%%%%%%%%%%%%%
% , and that each operand
% needed for the computation is available on one single server, the example
% presented in Figure~\ref{fig:submit_pb} considers the submission of the
% problem \texttt{F()} involving data \texttt{A} and \texttt{B}.
%\begin{figure}[hbt]
%  \begin{center}
%    \resizebox{8cm}{!}{\includegraphics{fig/submit_pb.eps}}
%    \caption{Problem submission example}
%    \label{fig:submit_pb}
%  \end{center}
%\end{figure}
%%%%%%%%%%%%%%%


\begin{itemize}
\item The MA propagates the client request through its subtrees down
  to the capable servers; actually, the agents only forward the
  request on those subtrees offering the service.
\item Each server that can satisfy the request can send his 
  performance and hardware information or  an estimation of  the 
  computation time necessary to process the request to its ``parent'' (an LA)
  (via performance prediction tools: see chapter~\ref{chapter:performance}). 
\item Each LA that receives one or more positive responses from its
  children sorts the servers and forwards the best responses to the MA
  through the hierarchy.
\item Once the MA has collected all the responses from its direct
  children, it chooses a pool of fast servers and sends their
  references to the client.
\end{itemize}

%====[ Extensions ]============================================================
\section{DIET Extensions}
\label{sec:extensions}

%====[ Multi-MA ]==============================================================
\subsection{Multi-MA}
\label{init:multima}

A standard \textsc{Diet} platform gives access to SeDs placed under
the control of a MA as explained at the beginning of this
chapter. Sometime, it is useful to connect several MA together. This
happens when several organizations wish to share their resources to
offer a larger set of service types and more available servers. The
Multi-MA extension allows this by creating a federation which shares
resources between several MA.

In multi-MA mode, the behavior of a \textsc{Diet} hierarchy does not change when a
client requests a service that is available under the queried MA.  However, if
a request sent to a MA does not found a SeD that can resolve its problem, \textsc{Diet}
will forward the request to other MAs of the federation.  To read more about
multi-MA, see Chapter~\ref{ch:multiMAextension} and
Chapter~\ref{ch:p2pextension}.

%====[ FAST ]==============================================================
\subsection{FAST}
\label{sub:fast}

Fast Agent's System Timer (FAST)~\cite{Qui02} is a tool for dynamic
performance forecasting in a Grid environment.  When \textsc{Diet} is
compiled with the appropriate options and FAST has been configured
on the SeD machine, SeDs can access FAST to obtain dynamic
performance predictions.  See Chapter~\ref{chapter:performance} for details
on using FAST.

%====[ CoRI ]==============================================================
\subsection{CoRI}
\label{sub:cori}

Collector of Resource Information (CoRI) is a manager for collecting
hardware and performance information.  When \textsc{Diet} is compiled with
the appropriate option, it is possible to get this information via
different sub-modules like FAST* or CoRI-Easy. (* if compiled and
configured on the SeD machine). See Chapter~\ref{chapter:performance}
for details on using CoRI.

%%%%%%%%%%%%%%%
%% FIXME:
%%  Memory aspects should be treated here.
%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%
%% FIXME for DIET v1.1
%%%%%%%%%%%%%%%
% In order to solve the problem itself, the client connects to one of
% the servers chosen: it sends its local data and specifies if the
% results should be kept in-place for further computation or if they
% should be brought back. The transfer of persistent operands is
% performed at this stage.
%%%%%%%%%%%%%%%

