%****************************************************************************%
%* DIET User's Manual installing chapter file                               *%
%*                                                                          *%
%*  Author(s):                                                              *%
%*    - Eddy CARON (Eddy.Caron@ens-lyon.fr)                                 *%
%*    - Pushpinder Kaur Chouhan (Pushpinder.Kaur.Chouhan@ens-lyon.fr)       *%
%*    - Philippe COMBES (Philippe.Combes@ens-lyon.fr)                       *%
%*                                                                          *%
%* $LICENSE$                                                                *%
%****************************************************************************%
%* $Id$
%* $Log$
%* Revision 1.25  2006/05/12 12:12:32  sdahan
%* Add some documentation about multi-MA
%*
%* Bug fix:
%*  - segfault when the neighbours configuration line was empty
%*  - deadlock when a MA create a link on itself
%*
%* Revision 1.24  2006/01/25 16:52:55  pfrauenk
%* CoRI : renaming of the chapter performance prediction with fast
%* 	to performance prediction, add of the CoRI Usersmanual,
%* 	changes in the plugin scheduler
%*
%* Revision 1.23  2005/08/26 08:32:42  rbolze
%* remove --enable-logservice feature.
%*
%* Revision 1.22  2005/07/12 08:54:10  ecaron
%* fix BLAS and ScaLAPACK (no fixme in fact)
%*
%* Revision 1.21  2005/06/27 19:26:52  hdail
%* - Moved introduction to FAST to description section with intro to multi-MA and
%*   gave both chapter references.
%* - Changed version number to 2.0.
%* - Moved info on compiling FAST itself to fast section from install section.
%*   install section still explains how to configure DIET with FAST.
%*
%* Revision 1.20  2005/06/24 15:07:29  hdail
%* Continuing english corrections and updating.
%*
%* Revision 1.19  2005/06/14 08:06:20  ecaron
%* Update ./configure output
%*
%* Revision 1.18  2005/05/29 13:51:22  ycaniou
%* Moved the section concerning FAST from description to a new chapter about FAST
%* and performances prediction.
%* Moved the section about convertors in the FAST chapter.
%* Modified the small introduction in chapter 1.
%* The rest of the changes are purely in the format of .tex files.
%*
%* Revision 1.17  2005/05/20 19:06:01  mjan
%* Short description of how to configure DIET for JuxMem
%*
%* Revision 1.16  2004/10/25 08:59:56  sdahan
%* add the multi-MA documentation
%*
%* Revision 1.15  2004/07/12 08:33:58  rbolze
%* explain how to copy cfgs file in install_dir/etc directory and correct my english
%****************************************************************************%

\chapter{DIET installation}
\label{ch:installing}

%====[ Dependencies ]==========================================================
\section{Dependencies}
\label{sec:dependencies}

\subsection{Hardware dependencies}

DIET has been fully tested on Linux i386 and i686 platforms and has 
been (at some time) tested on Solaris/Sparc, Linux/Sparc, Linux/i64,
Linux/amd64 and Linux/Alpha platform and seems/seemed to be supported.

If you found a bug in DIET, please to submit a bug report at
\url{http://graal.ens-lyon.fr/bugzilla}. If you have multiple bugs
to report, please make multiple submissions, rather than submitting
multiple bugs in one report.

\subsection{Software dependencies}

As explained in Section~\ref{sec:CORBA}, CORBA is used for all
communications inside the platform. The implementations of CORBA
currently supported in DIET are:
\begin{itemize}
 \item{\textbf{omniORB 3}} which depends on \textbf{Python 1.5}
 \item{\textbf{omniORB 4}} which depends on \textbf{Python 2.1} or
                           later, and on \textbf{OpenSSL} if you would
                           like your DIET platform to be
                           secure.~\footnote{If you want to deploy a
                           secure DIET platform, SSL support is not
                           yet implemented  in DIET, but an easy way
                           to do so is to deploy DIET on a VPN.}
% \item{soon \textbf{TAO 1.3}} which depends on \textbf{ACE} (but TAO is always
%                           provided with ACE)
\end{itemize}
We strongly recommend omniORB 4, as it is easier to install,
provides SSL support, and is the version currently used by our
developers so support will be better. In order to deploy CORBA
services with omniORB, a configuration file and a log directory are
required: see Section
\ref{sec:CORBA_services} for a complete description of the services.
Their paths can be given to omniORB through environment variables
(\texttt{\$OMNIORB\_CONFIG} and \texttt{\$OMNINAMES\_LOGDIR}), and/or,
for \textbf{omniORB 4} only, at compile time, with the
\texttt{--with-omniORB-config} and \texttt{--with-omniNames-logdir}
options.

\noindent 
\textbf{NB:} We have noticed that some problems occur with
\textbf{Python 2.3}: the C++ code generated could not be compiled. It
has been patched in DIET, but some warnings still appear.  \\

Since omniORB needs thread-safe management of exception handling,
compiling DIET with \verb+gcc+ requires at least \verb+gcc-2.96+.  \\

Some examples provided in the DIET sources depend on the BLAS
and \scalapack\ libraries. However these examples do not have to be
compiled.


%====[ Compilation ]===========================================================
\section{Compiling the platform}
\label{sec:compil_platform}

Once all dependencies are satisfied, untar the DIET archive and change
to its root directory. A configure script will prepare DIET for
compiling: its main options are described below, but please, run
\texttt{configure --help} to get an up-to-date and complete usage
description.\\

\noindent
{\footnotesize
\texttt{$\sim$> tar xzf DIET\_}\dietversion\texttt{.tgz} \\
\texttt{$\sim$> cd DIET} \\
\texttt{$\sim$/DIET> ./configure --help=short} \\
\texttt{Configuration of DIET} \dietversion \texttt{:} \\
\texttt{...}
}

\subsection{Optional features for configuration}

{\footnotesize
\begin{verbatim}
  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
  --enable-maintainer-mode enable make rules and dependencies not useful
                          (and sometimes confusing) to the casual installer
\end{verbatim}

\begin{verbatim}
  --enable-doc            enable the module doc, documentation about DIET
\end{verbatim}
}
\noindent This option activates the compilation and installation of
the DIET documents, which is disabled by default, because it is very
sensitive to the version of your \LaTeX\ compiler. The output
postscript files are provided in the archive.

{\footnotesize
\begin{verbatim}
  --disable-examples      disable the module examples, basic DIET examples
\end{verbatim}
}
\noindent This option deactivates the compilation of the DIET
examples, which is enabled by default.

{\footnotesize
\begin{verbatim}
  --enable-BLAS           enable the module BLAS, an example for calling BLAS
                          functions through DIET
\end{verbatim}
}
\noindent This option activates the compilation of the DIET BLAS
examples, as a sub-module of examples (which means that this option
has no effect if examples are disabled) - disabled by default.


{\footnotesize
\begin{verbatim}
 --enable-ScaLAPACK      enable the module ScaLAPACK, an example for calling
                          ScaLAPACK functions through DIET
\end{verbatim}
}
\noindent \textit{Experimental}.  This option activates the
compilation of the DIET \scalapack\ examples, as a sub-module of
examples (which means that this option has no effect if examples are
disabled) - disabled by default.

{\footnotesize
\begin{verbatim}
  --enable-JXTA-mode      enable DIET/JXTA architecture
\end{verbatim}
}
\noindent \textit{Experimental}.  This option allows the user to
deploy DIET$_{JXTA}$ architectures.  When this option is activated
(disabled by default), DIET allows only this type of architecture to
be deployed.

\label{sec:multimainstall}
{\footnotesize
\begin{verbatim}
  --enable-multi-MA       enable multi-MA architecture
\end{verbatim}
}
\noindent \textit{Experimental}.  This option allows the user to
connect several MA to be linked together. When this option is
activated, it allow a MA to looking for a SeD into the other MA
hierarchies.

{\footnotesize
\begin{verbatim}
  --enable-JuxMem       enable the use of JuxMem for managing persistent data
\end{verbatim}
}
\noindent \textit{Experimental}.  This option allows the user to
interact with JuxMem for the management of persistent data. When
this option is activated (disabled by default), a SeD can store data
blocks within JuxMem. Chapter~\ref{ch:juxmem} describes in more
details JuxMem and its use inside DIET.

{\footnotesize
\begin{verbatim}
  --enable-cori       enable the use of CoRI for collecting information 
                      about the SeD
\end{verbatim}
}
\noindent \textit{Experimental}.  This option allows the user to
get hardware and performance information about the SeD. When
this option is activated (disabled by default), the user can call FAST and other 
collectors by the interface CoRI. It can be used to improve the plug-in scheduler.
Chapter~\ref{chapter:performance} describes in more details CoRI and its use inside DIET.

{\footnotesize
\begin{verbatim}
  --enable-stats          enable generation of statistics logs
  --disable-dependency-tracking Speeds up one-time builds
  --enable-dependency-tracking  Do not reject slow dependency extractors
  --enable-shared=PKGS    build shared libraries default=yes
  --enable-static=PKGS    build static libraries default=yes
  --enable-fast-install=PKGS optimize for fast installation default=yes
  --disable-libtool-lock  avoid locking (might break parallel builds)
\end{verbatim}
}

%%{\footnotesize
%%\begin{verbatim}
%%  --enable-logservice     enable monitoring through LogService
%%\end{verbatim}
%%}
%%\noindent \textit{Deprecated}.  Support for the LogService monitoring
%%software is now always compiled in.  Note that support for LogService
%%is built-in and you do not have to install LogService to compile
%%DIET.

\subsection{Optional packages for configuration}


{\footnotesize
\begin{verbatim}
  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
  --with-gnu-ld           assume the C compiler uses GNU ld default=no
  --with-pic              try to use only PIC/non-PIC objects default=use both
\end{verbatim}
}

%% \subsubsection{The \texttt{--with-PKG-extra} option}

%% For all packages that DIET depends on, the \texttt{configure} script provides an
%% option that let the user define the arguments needed to compile with the
%% libraries of the package PKG: \texttt{--with-PKG-extra}. This is useful when
%% the \texttt{configure} script does not succeed on its own to get necessary
%% compilation option.

%% Let us take the example of a user who wishes to compile the BLAS examples (see
%% the BLAS subsection below). On the platform he/she uses, it is necessary to
%% specify the following arguments to compile with the BLAS library:

%% {\footnotesize \texttt{-lm -L/home/theuser/lib -lblas -lg2c -lm} }

%% \noindent
%% Let us assume that specifying the option
%% \texttt{--with-BLAS-libraries=/home/theuser/lib} is not enough for the
%% \texttt{configure} script to compile DIET examples. Then, the user will have to
%% add the following arguments to his/her \texttt{configure} command line:

%% {\footnotesize \texttt{--with-BLAS-extra="-lm -L/home/theuser/lib -lblas -lg2c
%%   -lm"} }

\subsubsection{omniORB}
{\footnotesize
\begin{verbatim}
  --with-omniORB=DIR      specify the root installation directory of omniORB
  --with-omniORB-includes=DIR
                          specify exact header directory for omniORB
  --with-omniORB-libraries=DIR
                          specify exact library directory for omniORB
  --with-omniORB-extra=ARG|"ARG1 ARG2 ..."
                          specify extra conftest.c -o conftest for the linker
                          to find the omniORB libraries (use "" in case of 
                          several conftest.c -o conftest)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with omniORB. Generally, \texttt{--with-omniORB=DIR}
should be enough, and the other options are provided for ugly
installations of omniORB.\\ \textbf{NB:} having the executable
\texttt{omniidl} in the PATH environment variable should be enough in
most cases.

\subsubsection{FAST}\label{fast_compil}
{\footnotesize
\begin{verbatim}
  --with-FAST=DIR         installation root directory for FAST (optional)
  --with-FAST-bin=DIR     installation directory for fast-config (optional)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with FAST; Generally, \texttt{--with-FAST=DIR} should
be enough, and the other options are provided for difficult
installations of FAST. There is no need to specify includes, libraries
and extra arguments, since FAST provides a tool \texttt{fast-config}
that does this job automatically.\\ \textbf{NB1:} having the
executable \texttt{fast-config} in the PATH environment variable
should be enough in most cases.\\ \textbf{NB2:} it is possible to
specify \texttt{--without-FAST}, which overrides \texttt{fast-config}
detection.

\subsubsection{BLAS}

The BLAS~\footnote{\url{http://www.netlib.org/blas/}} (Basic Linear
Algebra Subprograms) are high quality ``building block'' routines for
performing basic vector and matrix operations.  Level 1 BLAS do
vector-vector operations, Level 2 BLAS do matrix-vector operations,
and Level 3 BLAS do matrix-matrix operations. Because the BLAS are
efficient, portable, and widely available, they're commonly used in
the development of high quality linear algebra software.

{\footnotesize
\begin{verbatim}
  --with-BLAS=DIR  specify the root installation directory of BLAS (Basic
                   Linear Algebric Subroutines)

  --with-BLAS-includes=DIR
                   specify exact header directory for BLAS
  --with-BLAS-libraries=DIR
                   specify exact library directory for BLAS
  --with-BLAS-extra=ARG|"ARG1 ARG2 ..."
                   specify extra conftest.c -o conftest for the linker to find
                   the BLAS libraries (use "" in case of several 
                   conftest.c -o conftest)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with the BLAS libraries. Generally,
\texttt{--with-BLAS=DIR} should be enough, and the other options are
provided for difficult installation of the BLAS.\\ \textbf{NB:} these
options have no effect if the module example and/or its sub-module
BLAS are disabled.

\subsubsection{\scalapack}

The ScaLAPACK\footnote{\url{http://www.netlib.org/scalapack/}} (or
Scalable LAPACK) library includes a subset of LAPACK routines
redesigned for distributed memory MIMD parallel computers. It is
currently written in a Single-Program-Multiple-Data style using
explicit message passing for interprocessor communication. It assumes
matrices are laid out in a two-dimensional block cyclic decomposition.

Like LAPACK, the ScaLAPACK routines are based on block-partitioned
algorithms in order to minimize the frequency of data movements
between different levels of the memory hierarchy. For such machines,
the memory hierarchy includes the off-processor memory of other
processors, in addition to the hierarchy of registers, cache, and
local memory on each processor.  The fundamental building blocks of
the ScaLAPACK library are distributed memory versions (PBLAS) of the
Level 1, 2 and 3 BLAS, and a set of Basic Linear Algebra Communication
Subprograms (BLACS) for communication tasks that arise frequently in
parallel linear algebra computations. In the ScaLAPACK routines, all
interprocessor communication occurs within the PBLAS and the BLACS.
One of the design goals of ScaLAPACK was to have the ScaLAPACK
routines resemble their LAPACK equivalents as much as possible.

For detailed information on ScaLAPACK, please refer to the ScaLAPACK
Users' Guide~\cite{BCC+97}.


{\footnotesize
\begin{verbatim}
  --with-ScaLAPACK=DIR    specify the root installation directory of ScaLAPACK
                          (parallel version of the LAPACK library)

  --with-ScaLAPACK-includes=DIR
                          specify exact header directory for ScaLAPACK
  --with-ScaLAPACK-libraries=DIR
                          specify exact library directory for ScaLAPACK
  --with-ScaLAPACK-extra=ARG|"ARG1 ARG2 ..."
                          specify extra conftest.c -o conftest for the linker to find 
                          the ScaLAPACK libraries (use "" in case of several 
                          conftest.c -o conftest)
\end{verbatim}
}

\noindent This group of options lets the user define all necessary
paths for compilation with the \scalapack\ libraries. Normally,
\texttt{--with-ScaLAPACK=DIR} could be enough, but the other options
are provided because the installation of the \scalapack\ libraries is
often difficult, and thus difficult to detect automatically. For
instance, the \texttt{--with-ScaLAPACK-extra} option is useful to
integrate BLACS and MPI libraries, which are useful for ScaLAPACK.  \\
\textbf{NB:} these options have no effect if the module example and/or
its sub-module \scalapack\ are disabled.

\subsection{From configuration to compilation}

An important option for configure scripts is \texttt{--prefix=}, which
specifies where binary files, documents and configuration files will
be installed. It is important to set this option; otherwise it 
defaults to \texttt{DIET/install}.

The configuration will return with an error if no ORB was found. So
please help the configure script to find the ORB with the
\texttt{--with-omniORB*} options.\\


If everything went OK, the configuration ends with a summary of the
options that were selected and what it was possible to get. The output
will look like: {\footnotesize
\begin{verbatim}
~/DIET > ./configure --enable-examples --enable-doc
DIET successfully configured as follows:
 - Batch:           no
 - documents:       yes
 - examples:        dmat_manips, file_transfer, scalars
 - FAST:            disabled
 - CORI:            disabled
 - ORB:             omniORB 4 in /usr
 - prefix:          /home/username/DIET/install
 - multi-MA:        no
 - DIET J:          no
 - Juxmem:          no
 - target platform: i686-pc-linux-gnu
 
Please run make help to get compilation instructions.
~/DIET > make help
====================================================================
 Usage : make help     : shows this help screen
         make agent    : builds DIET agent executable
         make SeD      : builds DIET SeD library
         make client   : builds DIET client library
         make examples : builds basic examples
         make          : builds everything configured
         make install  : copy files into /home/username/DIET/install
====================================================================
\end{verbatim}
}

This helps the user to choose which DIET parts to compile and
install. It is recommended for beginners to compile the client,
the SeD and the agent in one single step with \texttt{make all}. But
please pay attention to the fact that \texttt{make all} does not
install DIET in the prefix provided at configuration time. To do this,
run \texttt{make install}.

\texttt{make install} will run the compilation for all DIET entities
before the installation itself. Thus, if the user wants to compile
only the agent, for instance, and install it, he must run:
{\footnotesize
\begin{verbatim}
~/DIET > cd src/agent
~DIET/src/agent > make install
\end{verbatim}
}


\section{Compiling the examples}

Four series of examples are provided in the DIET archive:
\begin{itemize}
\item{\texttt{file\_transfer}}: the server computes the sizes of two
  input files and returns them. A third output parameter may be
  returned; the server decides randomly whether to send back the
  first file. This is to show how to manage a variable number of
  arguments: the profile declares all arguments that may be filled,
  even if they might not be all filled at each request/computation.

\item{\texttt{dmat\_manips}}: the server offers matrix manipulation
  routines: transposition (\texttt{T}), product (\texttt{MatPROD}) and
  sum (\texttt{MatSUM}, \texttt{SqMatSUM} for square matrices, and
  \texttt{SqMatSUM\_opt} for square matrices but re-using the memory
  space of the second operand for the result). Any subset of these
  operations can be specified on the command line. The last two of
  them are given for compatibility with a BLAS server as explained below.
  
\item{\texttt{BLAS}}: the server offers the \texttt{dgemm} BLAS
  functionality.  We plan to offer all BLAS (Basic Linear Algebric
  Subroutines) in the future. Since this function computes
  $C = \alpha AB + \beta C$, it can also compute a matrix-matrix
  product, a sum of square matrices, etc. All these services are
  offered by the BLAS server. Two clients are designed to use these
  services: one (\texttt{dgemm\_client.c}) is designed to use the
  \texttt{dgemm\_} function only, and the other one
  (\texttt{client.c}) to use all BLAS functions (but currently only
  \texttt{dgemm\_}) and sub-services, such as \texttt{MatPROD}.
  
\item{\texttt{\scalapack}}: the server is designed to offer all
  \scalapack\  (parallel version of the LAPACK library) functions but
  only manages the \texttt{pdgemm\_} function so far. The
  \texttt{pdgemm\_} routine is the parallel version of the
  \texttt{dgemm\_} function, so that the server also offers all the
  same sub-services. Two clients are designed to use these services:
  one (\texttt{pdgemm\_client.c}) is designed to use the
  \texttt{pdgemm\_} function only, and the other one
  (\texttt{client.c}) to use all \scalapack\ functions and
  sub-services, such as \texttt{MatPROD}.
\end{itemize}

Running \texttt{make install} in the \texttt{examples} directory (or
in the root directory, when DIET is configured with
\texttt{--enable-examples}) does not copy binary files into
\texttt{$<$install\_dir$>$/bin}, but in \texttt{examples/bin}: this
odd behaviour is due to some limitations of the \textsf{automake} tool.

Likewise, the samples of configuration files located in
\texttt{examples/cfgs} are processed by \texttt{make install} to
create ready-to-use configuration files in \texttt{examples/etc} and
then copied into \texttt{$<$install\_dir$>$/etc}. Successive calls to
make install will not erase the configuration files created and copied
the first time, except if \texttt{make uninstall} is called inbetween
; thus the user will not lose changes to these files.

