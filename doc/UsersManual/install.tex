%****************************************************************************%
%* DIET User's Manual installing chapter file                               *%
%*                                                                          *%
%*  Author(s):                                                              *%
%*    - Eddy CARON (Eddy.Caron@ens-lyon.fr)                                 *%
%*    - Pushpinder Kaur Chouhan (Pushpinder.Kaur.Chouhan@ens-lyon.fr)       *%
%*    - Philippe COMBES (Philippe.Combes@ens-lyon.fr)                       *%
%*                                                                          *%
%* $LICENSE$                                                                *%
%****************************************************************************%
%* $Id$
%* $Log$
%* Revision 1.19  2005/06/14 08:06:20  ecaron
%* Update ./configure output
%*
%* Revision 1.18  2005/05/29 13:51:22  ycaniou
%* Moved the section concerning FAST from description to a new chapter about FAST
%* and performances prediction.
%* Moved the section about convertors in the FAST chapter.
%* Modified the small introduction in chapter 1.
%* The rest of the changes are purely in the format of .tex files.
%*
%* Revision 1.17  2005/05/20 19:06:01  mjan
%* Short description of how to configure DIET for JuxMem
%*
%* Revision 1.16  2004/10/25 08:59:56  sdahan
%* add the multi-MA documentation
%*
%* Revision 1.15  2004/07/12 08:33:58  rbolze
%* explain how to copy cfgs file in install_dir/etc directory and correct my english
%*
%* Revision 1.14  2004/07/09 14:34:42  rbolze
%* make changes relative to DIET 1.1 version
%*
%* Revision 1.13  2004/07/06 13:40:42  ctedesch
%* add corrections from Raphael Bolze.
%*
%* Revision 1.12  2004/04/09 11:19:32  rbolze
%* Add the testing platform : Linux/amd64
%*
%* Revision 1.11  2004/04/05 11:04:29  rbolze
%* add instruction to compile with logService
%*
%* Revision 1.10  2004/02/10 00:13:55  ecaron
%* Add bugzilla reference.
%*
%* Revision 1.9  2004/01/29 17:08:47  ecaron
%* Add suggestions from Frederic Desprez. Thanks !
%*
%* Revision 1.8  2004/01/21 23:23:03  ecaron
%* Add suggestions from Jean-Yves. Thanks !
%*
%* Revision 1.7  2004/01/21 00:25:13  ecaron
%* Add suggestions from Holly Dail. Thanks !
%*
%* Revision 1.6  2004/01/07 20:25:04  ecaron
%* Add ScaLAPACK and BLAS introduction
%*
%* Revision 1.5  2004/01/06 15:07:46  ecaron
%* Correct latex bug
%*
%* Revision 1.4  2003/12/12 14:42:44  pkchouha
%*  define \diet_version in UserManual.tex to be 1.0
%*
%* Revision 1.3  2003/12/03 11:06:57  pkchouha
%* 1. change the version of DIET to 1.0
%* 2. DIET.tgz to DIET_1.0.tgz
%* 3. added the unlisted options in  section 2.2.1
%* 4. commented the  all part of section 2.2.2 before the subcetion oniORB
%* 5. added the unlisted options in section 2.2.2
%* 6. changed the args to conftest.c -o conftest
%* 7. changed some words and sentances for simplification
%*
%* Revision 1.2  2003/11/28 11:51:36  pcombes
%* Correction about gcc-2.96 management of exception handling.
%*
%* Revision 1.1  2003/09/09 12:38:20  pcombes
%* Reorganization of doc: UM becomes UsersManual.
%*
%* Revision 1.12  2003/06/23 13:14:09  pcombes
%* Update example to new configuration summary.
%*
%* Revision 1.11  2003/06/16 17:39:55  pcombes
%* One word about gcc-2.96.
%*
%* Revision 1.10  2003/06/02 13:47:05  pcombes
%* Fix footnotesize.
%*
%* Revision 1.9  2003/05/23 09:23:35  pcombes
%* Add suggestions from Jean-Yves. Thanks !
%*
%* Revision 1.8  2003/05/15 14:17:58  pcombes
%* UM 0.7
%*
%* Revision 1.6  2003/01/24 16:58:54  pcombes
%* UM 0.6.4
%*
%* Revision 1.5  2003/01/22 17:34:53  pcombes
%* User Manual, v. 0.6.4
%****************************************************************************%


\chapter{DIET installation}
\label{ch:installing}

%====[ Dependencies ]==========================================================
\section{Dependencies}
\label{sec:dependencies}

\subsection{Hardware dependencies}

DIET has fully tested on Linux i386 and i686 platforms and has tested
on Solaris/Sparc, Linux/Sparc, Linux/i64, Linux/amd64 and Linux/Alpha
platform and seems be supported.

If you found a bug into DIET, please to submit a bug report at
\url{http://graal.ens-lyon.fr/bugzilla}. If you have multiple bugs to
report, please make multiple submissions, rather than submitting
multiple bugs in one report.

\subsection{Software dependencies}

As explained in Section \ref{sec:CORBA}, CORBA is used for all
communications inside the platform. So all of the three parts depend
on it. The implementations of CORBA currently supported in DIET are:
\begin{itemize}
 \item{\textbf{omniORB 3}} which depends on \textbf{Python 1.5}
 \item{\textbf{omniORB 4}} which depends on \textbf{Python 2.1} or
                           later, and on \textbf{OpenSSL} if you would
                           like your DIET platform to be
                           secure.~\footnote{If you want to deploy a
                           secure DIET platform, SSL support is not
                           yet implemented  in DIET, but an easy way
                           to do so is to deploy DIET on a VPN.}
% \item{soon \textbf{TAO 1.3}} which depends on \textbf{ACE} (but TAO is always
%                           provided with ACE)
\end{itemize}
We strongly recommend omniORB 4, as it is easier to install, and
provides SSL support. In order to deploy CORBA services with omniORB,
a configuration file and a log directory are required: see Section
\ref{sec:CORBA_services} for a complete description of the services.
Their path can be given to omniORB through environment variables
(\texttt{\$OMNIORB\_CONFIG} and \texttt{\$OMNINAMES\_LOGDIR}), and/or,
for \textbf{omniORB 4} only, at compile time, with the
\texttt{--with-omniORB-config} and \texttt{--with-omniNames-logdir}
options.

\noindent 
\textbf{NB:} We have noticed that some problems occur with
\textbf{Python 2.3}: the C++ code generated could not be compiled. It
has been patched in DIET, but some warnings still appear.  \\

Since omniORB needs a thread-safe management of exception handling,
compiling DIET with \verb+gcc+ requires at least \verb+gcc-2.96+.  \\

The agent and server parts of DIET can depend on FAST (see
§\ref{sec:FAST}).  Although not absolutely compulsory, it is strongly
recommended: indeed, all communication and computation times are set
to infinity if FAST is not installed.  FAST depends on:
\begin{itemize}
 \item{\textbf{DB 2}} the Berkeley Database routines
 \item{\textbf{GSL}} the GNU Scientific Library
 \item{\textbf{OpenLDAP}} an implementation of the Lightweight
                          Directory Access Protocol
 \item{\textbf{NWS}} the Network Weather Service
\end{itemize}
For more details about FAST dependencies, please refer to the FAST
Reference Manual~\footnote{\url{http://graal.ens-lyon.fr/FAST/docs}}.
It is important to understand basically how FAST works, and the role
of its dependencies, to deactivate the ones that are not needed by the
user.\\

Finally, some examples provided in the DIET sources depend on the BLAS
and \scalapack\ libraries. However theses examples do not have to be
compiled.


%====[ Compilation ]===========================================================
\section{Compiling the platform}
\label{sec:compil_platform}

Once all dependencies are satisfied, untar the DIET archive and change
to its root directory. A configure script will prepare DIET for
compiling: its main options are described below, but please, run
\texttt{configure --help} to get an up-to-date and complete usage
description.\\

\noindent
{\footnotesize
\texttt{$\sim$> tar xzf DIET\_}\dietversion\texttt{.tgz} \\
\texttt{$\sim$> cd DIET} \\
\texttt{$\sim$/DIET> ./configure --help=short} \\
\texttt{Configuration of DIET} \dietversion \texttt{:} \\
\texttt{...}
}

\subsection{Optional features for configuration}

{\footnotesize
\begin{verbatim}
  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
  --enable-maintainer-mode enable make rules and dependencies not useful
                          (and sometimes confusing) to the casual installer
\end{verbatim}

\begin{verbatim}
  --enable-doc            enable the module doc, documentation about DIET
\end{verbatim}
}
\noindent This option activates the compilation and installation of
the DIET documents, which is disabled by default, because it is very
sensitive to the version of your \LaTeX\ compiler. The output
postscript files are provided in the archive.

{\footnotesize
\begin{verbatim}
  --disable-examples      disable the module examples, basic DIET examples
\end{verbatim}
}
\noindent This option deactivates the compilation of the DIET
examples, which is enabled by default.

{\footnotesize
\begin{verbatim}
  --enable-BLAS           enable the module BLAS, an example for calling BLAS
                          functions through DIET
\end{verbatim}
}
\noindent This option activates the compilation of the DIET BLAS
examples, as a sub-module of examples (which means that this option
has no effect if examples are disabled) - disabled by default.

{\footnotesize
\begin{verbatim}
  --enable-logservice     enable monitoring through LogService
\end{verbatim}
}
\noindent This option enables the connection from DIET to the
LogService monitoring software. It will enable DIET to generate
monitoring data and send it to the LogService. Note that the support
of LogService is built in. You do not have to install the LogService
package to compile with this option.


{\footnotesize
\begin{verbatim}
 --enable-ScaLAPACK      enable the module ScaLAPACK, an example for calling
                          ScaLAPACK functions through DIET
\end{verbatim}
}
\noindent This option activates the compilation of the DIET
\scalapack\ examples, as a sub-module of examples (which means that
this option has no effect if examples are disabled) - disabled by
default.

{\footnotesize
\begin{verbatim}
  --enable-JXTA-mode      enable DIET/JXTA architecture
\end{verbatim}
}
\noindent This option allows the user to deploy DIET$_{JXTA}$
architectures.  When this option is activated (disable by default),
DIET allows only this type of architecture to be deployed.

{\footnotesize
\begin{verbatim}
  --enable-multi-MA       enable multi-MA architecture
\end{verbatim}
}
\noindent This option allows the user to connect several MA to be
linked together. When this option is activated, it allow a MA to
looking for a SeD into the other MA hierarchies.

{\footnotesize
\begin{verbatim}
  --enable-JuxMem       enable the use of JuxMem for managing persistent data
\end{verbatim}
}
\noindent This option allows the user to interact with JuxMem for the
management of persistent data. When this option is activated (disabled
by default), a SeD can store data blocks within
JuxMem. Chapter~\ref{ch:juxmem} describes in more details JuxMem and
its use inside DIET.

{\footnotesize
\begin{verbatim}
  --enable-Cichlid        enable generation of communication logs for Cichlid
  --enable-stats          enable generation of statistics logs
  --disable-dependency-tracking Speeds up one-time builds
  --enable-dependency-tracking  Do not reject slow dependency extractors
  --enable-shared=PKGS    build shared libraries default=yes
  --enable-static=PKGS    build static libraries default=yes
  --enable-fast-install=PKGS optimize for fast installation default=yes
  --disable-libtool-lock  avoid locking (might break parallel builds)
\end{verbatim}
}

\subsection{Optional packages for configuration}


{\footnotesize
\begin{verbatim}
  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
  --with-gnu-ld           assume the C compiler uses GNU ld default=no
  --with-pic              try to use only PIC/non-PIC objects default=use both
\end{verbatim}
}

%% \subsubsection{The \texttt{--with-PKG-extra} option}

%% For all packages that DIET depends on, the \texttt{configure} script provides an
%% option that let the user define the arguments needed to compile with the
%% libraries of the package PKG: \texttt{--with-PKG-extra}. This is useful when
%% the \texttt{configure} script does not succeed on its own to get necessary
%% compilation option.

%% Let us take the example of a user who wishes to compile the BLAS examples (see
%% the BLAS subsection below). On the platform he/she uses, it is necessary to
%% specify the following arguments to compile with the BLAS library:

%% {\footnotesize \texttt{-lm -L/home/theuser/lib -lblas -lg2c -lm} }

%% \noindent
%% Let us assume that specifying the option
%% \texttt{--with-BLAS-libraries=/home/theuser/lib} is not enough for the
%% \texttt{configure} script to compile DIET examples. Then, the user will have to
%% add the following arguments to his/her \texttt{configure} command line:

%% {\footnotesize \texttt{--with-BLAS-extra="-lm -L/home/theuser/lib -lblas -lg2c
%%   -lm"} }

\subsubsection{omniORB}
{\footnotesize
\begin{verbatim}
  --with-omniORB=DIR      specify the root installation directory of omniORB
  --with-omniORB-includes=DIR
                          specify exact header directory for omniORB
  --with-omniORB-libraries=DIR
                          specify exact library directory for omniORB
  --with-omniORB-extra=ARG|"ARG1 ARG2 ..."
                          specify extra conftest.c -o conftest for the linker
                          to find the omniORB libraries (use "" in case of 
                          several conftest.c -o conftest)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with omniORB. Generally, \texttt{--with-omniORB=DIR}
should be enough, and the other options are provided for ugly
installations of omniORB.\\ \textbf{NB:} having the executable
\texttt{omniidl} in the PATH environment variable should be enough in
most cases.

\subsubsection{FAST}\label{fast_compil}
{\footnotesize
\begin{verbatim}
  --with-FAST=DIR         installation root directory for FAST (optional)
  --with-FAST-bin=DIR     installation directory for fast-config (optional)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with FAST. Generally, \texttt{--with-FAST=DIR} should
be enough, and the other options are provided for difficult
installations of FAST. There is no need to specify includes, libraries
and extra arguments, since FAST provides a tool \texttt{fast-config}
that does this job automatically.\\ \textbf{NB1:} having the
executable \texttt{fast-config} in the PATH environment variable
should be enough in most cases.\\ \textbf{NB2:} it is possible to
specify \texttt{--without-FAST}, which overrides \texttt{fast-config}
detection.

\subsubsection{BLAS}

The BLAS~\footnote{\url{http://www.netlib.org/blas/}} (Basic Linear
Algebra Subprograms) are high quality "building block" routines for
performing basic vector and matrix operations.  Level 1 BLAS do
vector-vector operations, Level 2 BLAS do matrix-vector operations,
and Level 3 BLAS do matrix-matrix operations. Because the BLAS are
efficient, portable, and widely available, they're commonly used in
the development of high quality linear algebra software.

{\footnotesize
\begin{verbatim}
  --with-BLAS=DIR  specify the root installation directory of BLAS (Basic
                   Linear Algebric Subroutines)

  --with-BLAS-includes=DIR
                   specify exact header directory for BLAS
  --with-BLAS-libraries=DIR
                   specify exact library directory for BLAS
  --with-BLAS-extra=ARG|"ARG1 ARG2 ..."
                   specify extra conftest.c -o conftest for the linker to find
                   the BLAS libraries (use "" in case of several 
                   conftest.c -o conftest)
\end{verbatim}
}
\noindent This group of options lets the user define all necessary
paths to compile with the BLAS libraries. Generally,
\texttt{--with-BLAS=DIR} should be enough, and the other options are
provided for difficult installation of the BLAS.\\ \textbf{NB:} these
options have no effect if the module example and/or its sub-module
BLAS are disabled.

\subsubsection{\scalapack}

The ScaLAPACK\footnote{\url{http://www.netlib.org/scalapack/}} (or
Scalable LAPACK) library includes a subset of LAPACK routines
redesigned for distributed memory MIMD parallel computers. It is
currently written in a Single-Program-Multiple-Data style using
explicit message passing for interprocessor communication. It assumes
matrices are laid out in a two-dimensional block cyclic decomposition.

Like LAPACK, the ScaLAPACK routines are based on block-partitioned
algorithms in order to minimize the frequency of data movements
between different levels of the memory hierarchy. (For such machines,
the memory hierarchy includes the off-processor memory of other
processors, in addition to the hierarchy of registers, cache, and
local memory on each processor.) The fundamental building blocks of
the ScaLAPACK library are distributed memory versions (PBLAS) of the
Level 1, 2 and 3 BLAS, and a set of Basic Linear Algebra Communication
Subprograms (BLACS) for communication tasks that arise frequently in
parallel linear algebra computations. In the ScaLAPACK routines, all
interprocessor communication occurs within the PBLAS and the BLACS.
One of the design goals of ScaLAPACK was to have the ScaLAPACK
routines resemble their LAPACK equivalents as much as possible.

For detailed information on ScaLAPACK, please refer to the ScaLAPACK
Users' Guide~\cite{BCC+97}.


{\footnotesize
\begin{verbatim}
  --with-ScaLAPACK=DIR    specify the root installation directory of ScaLAPACK
                          (parallel version of the LAPACK library)

  --with-ScaLAPACK-includes=DIR
                          specify exact header directory for ScaLAPACK
  --with-ScaLAPACK-libraries=DIR
                          specify exact library directory for ScaLAPACK
  --with-ScaLAPACK-extra=ARG|"ARG1 ARG2 ..."
                          specify extra conftest.c -o conftest for the linker to find 
                          the ScaLAPACK libraries (use "" in case of several 
                          conftest.c -o conftest)
\end{verbatim}
}

\noindent This group of options lets the user define all necessary
paths for compilation with the \scalapack\ libraries. Normally,
\texttt{--with-ScaLAPACK=DIR} could be enough, but the other options
are provided because the installation of the \scalapack\ libraries is
often difficult, and thus difficult to detect automatically. For
instance, the \texttt{--with-ScaLAPACK-extra} option is useful to
integrate BLACS and MPI libraries, which are useful for ScaLAPACK.  \\
\textbf{NB:} these options have no effect if the module example and/or
its sub-module \scalapack\ are disabled.


\subsection{From configuration to compilation}

An important option for configure scripts is \texttt{--prefix=}, which
specifies where binary files, documents and configuration files will
be installed. It is important to set this option: it otherwise
defaults to \texttt{DIET/install}.

The configuration will return with an error if no ORB was found. So
please help the configure script to find the ORB with the
\texttt{--with-omniORB*} options.\\


If everything went OK, the configuration ends with a summary of the
options that were selected and what it was possible to get. The output
will look like: {\footnotesize
\begin{verbatim}
~/DIET > ./configure --enable-examples --enable-doc
DIET successfully configured as follows:
 - Batch:           no
 - documents:       yes
 - examples:        dmat_manips, file_transfer, scalars
 - FAST:            disabled
 - ORB:             omniORB 4 in /usr
 - prefix:          /home/username/DIET/install
 - multi-MA:        no
 - DIET J:          no
 - Juxmem:          no
 - target platform: i686-pc-linux-gnu
 
Please run make help to get compilation instructions.
~/DIET > make help
====================================================================
 Usage : make help     : shows this help screen
         make agent    : builds DIET agent executable
         make SeD      : builds DIET SeD library
         make client   : builds DIET client library
         make examples : builds basic examples
         make          : builds everything configured
         make install  : copy files into /home/username/DIET/install
====================================================================
\end{verbatim}
}

This helps the user to choose the DIET parts for installation and
compilation. It is recommended for beginners to compile the client,
the SeD and the agent in one single step with \texttt{make all}. But
please, pay attention to the fact that \texttt{make all} does not
install DIET in the prefix provided at configuration time. To do this,
run \texttt{make install}.

\texttt{make install} will run the compilation for all DIET entities
before the installation itself. Thus, if the user wants to compile
only the agent, for instance, and install it, he must run:
{\footnotesize
\begin{verbatim}
~/DIET > cd src/agent
~DIET/src/agent > make install
\end{verbatim}
}


\section{Compiling the examples}

Four series of examples are provided in the DIET archive:
\begin{itemize}
\item{\texttt{file\_transfer}}: the server computes the sizes of two
  input files and returns them. A third output parameter may be
  returned: randomly, the server decides to send back the first file.
  This is to show how to manage a variable number of arguments: the
  profile declares all arguments that may be filled, even if they
  might not be all filled at each request/computation.

\item{\texttt{dmat\_manips}}: the server offers matrix manipulation
  routines: transposition (\texttt{T}), product (\texttt{MatPROD}) and
  sum (\texttt{MatSUM}, \texttt{SqMatSUM} for square matrices, and
  \texttt{SqMatSUM\_opt} for square matrices but re-using the memory
  space of the second operand for the result). Any subset of these
  operations can be specified on the command line. The last two of
  them are given for compatibility with a BLAS server, explained below.
  
\item{\texttt{BLAS}}: the server offers the \texttt{dgemm} BLAS
  functionality.  We plan to offer all BLAS (Basic Linear Algebric
  Subroutines) in the next DIET version. Since this function computes
  $C = \alpha AB + \beta C$, it can also compute a matrix-matrix
  product, a sum of square matrices, etc. All these services are
  offered by the BLAS server. Two clients are designed to use these
  services: one (\texttt{dgemm\_client.c}) is designed to use the
  \texttt{dgemm\_} function only, and the other one
  (\texttt{client.c}) to use all BLAS functions (but currently only
  \texttt{dgemm\_}) and sub-services, such as \texttt{MatPROD}.
  
\item{\texttt{\scalapack}}: the server is designed to offer all
  \scalapack\  (parallel version of the LAPACK library) functions but
  only manages the \texttt{pdgemm\_} function so far. The
  \texttt{pdgemm\_} routine is the parallel version of the
  \texttt{dgemm\_} function, so that the server also offers all the
  same sub-services. Two clients are designed to use these services:
  one (\texttt{pdgemm\_client.c}) is designed to use the
  \texttt{pdgemm\_} function only, and the other one
  (\texttt{client.c}) to use all \scalapack\ functions and
  sub-services, such as \texttt{MatPROD}.
\end{itemize}

Running \texttt{make install} in the \texttt{examples} directory (or
in the root directory, when DIET is configured with
\texttt{--enable-examples}) does not copy binary files into
\texttt{$<$install\_dir$>$/bin}, but in \texttt{examples/bin}: this
odd behaviour is due to some limitations of the \textsf{automake} tool.

Likewise, the samples of configuration files located in
\texttt{examples/cfgs} are processed by \texttt{make install} to
create ready-to-use configuration files in \texttt{examples/etc} and
then copied into \texttt{$<$install\_dir$>$/etc}. Successive calls to
make install will not erase the configuration files created and copied
the first time, except if \texttt{make uninstall} is called inbetween
; thus the user will not lose the changes to these files.

