#****************************************************************************#
#* DIET cmake local file                                                    *#
#*                                                                          *#
#****************************************************************************#
#* $Author$
#* $LICENSE$
#* $Id$
#* $Log$
#* Revision 1.2  2005/04/29 10:36:37  eboix
#*     idl generated files are now taken into account.  --- Injay 2461
#*
#* Revision 1.1  2005/04/28 13:25:10  eboix
#*     Added cmake subdir configuration files. --- Injay 2461
#*
#****************************************************************************#

# When OMNIORB was found generate the code out of the IDL source files and
# build the ad-hoc libraries.
IF( OMNIORB4_FOUND )
  
  SET( IDL_SOURCES
    Agent
    Callback
    common_types
    DataMgr
    LogComponent
    LocalAgent
    LocMgr
    LogTypes
    MasterAgent
    response
    SeD )
  
  SET( TARGET_IDL_DIR  ${DIET_BINARY_DIR}/src/CORBA/idl )
  
  FOREACH( loop_var ${IDL_SOURCES} )
    ADD_CUSTOM_COMMAND(
      OUTPUT    ${TARGET_IDL_DIR}/${loop_var}SK.cc
      COMMAND   ${OMNIORB4_IDL_COMPILER}
      ARGS      -bcxx -Wba -Wbtp 
                ${DIET_SOURCE_DIR}/src/CORBA/idl/${loop_var}.idl
      DEPENDS   ${DIET_SOURCE_DIR}/src/CORBA/idl/${loop_var}.idl
      COMMENT   "idl generated code"
    )
    # FIXME: this will invoke twice the IDL compiler...but apparently
    #        cmake's ADD_CUSTOM_COMMAND doesn't authorise mutliple outputs
    ADD_CUSTOM_COMMAND(
      OUTPUT    ${TARGET_IDL_DIR}/${loop_var}DynSK.cc
      COMMAND   ${OMNIORB4_IDL_COMPILER}
      ARGS      -bcxx -Wba -Wbtp 
                ${DIET_SOURCE_DIR}/src/CORBA/idl/${loop_var}.idl
      DEPENDS   ${DIET_SOURCE_DIR}/src/CORBA/idl/${loop_var}.idl
      COMMENT   "idl generated code"
    )
    # Since the files generated by the IDL compiler do not exist, mark
    # them as GENERATED. (Note: a single execution of the IDL compiler
    # produces three outputs.
    SET_SOURCE_FILES_PROPERTIES( ${TARGET_IDL_DIR}/${loop_var}.hh GENERATED )
    SET_SOURCE_FILES_PROPERTIES( ${TARGET_IDL_DIR}/${loop_var}SK.cc GENERATED )
    SET_SOURCE_FILES_PROPERTIES( ${TARGET_IDL_DIR}/${loop_var}DynSK.cc GENERATED )
  ENDFOREACH(loop_var)
  
  INCLUDE_DIRECTORIES(
    ${OMNIORB4_INCLUDE_DIR}
    ${DIET_BINARY_DIR}/src/CORBA/idl     # Current directory
  )
  
  ADD_LIBRARY( IDLAgent 
    AgentSK.cc
    AgentDynSK.cc
    DataMgrSK.cc
    DataMgrDynSK.cc
    LogComponentDynSK.cc
    LogComponentSK.cc
    LocMgrSK.cc
    LocMgrDynSK.cc
    LogTypesSK.cc
    LogTypesDynSK.cc )
  
  ADD_LIBRARY( IDLCommon 
    CallbackDynSK.cc
    CallbackSK.cc
    common_typesSK.cc
    common_typesDynSK.cc
    responseDynSK.cc
    responseSK.cc
    SeDSK.cc
    SeDDynSK.cc )
  
  ADD_LIBRARY( IDLLA
    LocalAgentSK.cc
    LocalAgentDynSK.cc )
  
  ADD_LIBRARY( IDLMA
    MasterAgentSK.cc
    MasterAgentDynSK.cc )
  
ENDIF( OMNIORB4_FOUND )
