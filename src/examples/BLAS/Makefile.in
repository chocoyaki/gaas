#****************************************************************************#
#* $Id$ *#
#* DIET examples BLAS Makefile                                              *#
#*                                                                          *#
#*  Author(s):                                                              *#
#*    - Philippe COMBES           - LIP ENS Lyon (France)                   *#
#*    - Romain   LACROIX          - LIP ENS Lyon (France)                   *#
#*                                                                          *#
#*  This is part of DIET software.                                          *#
#*  Copyright (C) 2002 ReMaP/LIFC/INRIA                                     *#
#*                                                                          *#
#****************************************************************************#
#*
#* $Log$
#* Revision 1.8  2002/11/07 19:16:25  pcombes
#* Minor fixes in libs order.
#*
#* Revision 1.7  2002/11/07 18:42:42  pcombes
#* Add includes and configured Makefile variables to install directory.
#* Update dgemm to the implementation that is hardcoded in FAST.
#*
#* Revision 1.6  2002/11/06 16:09:24  pcombes
#* Fix bug in BLASLIBS
#*
#* Revision 1.5  2002/10/03 17:58:16  pcombes
#* Add trace levels (for Bert): traceLevel = n can be added in cfg files.
#* An agent son can now be killed (^C) without crashing this agent.
#* DIET with FAST: compilation is OK, but run time is still to be fixed.
#*
#* Revision 1.4  2002/09/17 15:23:16  pcombes
#* Bug fixes on inout arguments and examples
#* Add support for omniORB 4.0.0
#*
#* Revision 1.3  2002/09/09 15:56:51  pcombes
#* Update for dgemm and bug fixes
#*
#* Revision 1.2  2002/08/09 14:30:32  pcombes
#* This is commit set the frame for version 1.0 - does not work properly yet
#*
#****************************************************************************#


include @PREFIX@/include/Makefile.inc

BLASLIBS  = -lm -lblas -lm -lg2c
PBLASLIBS = -lm -lblacsCinit-mpich -lblacs-mpich -lblas \
	    -lscalapack-mpich -lm -lmpi -lg2c

.PHONY: dgemm pdgemm clean

all:	BLAS_client dgemm pdgemm


BLAS_client:	BLAS_client.o @PREFIX@/lib/libDIET_client.a
	$(CC) $< $(CCFLAGS) $(CLIENT_LIB) $(LIBS) -o $@

BLAS_client.o:	BLAS_client.c
	$(CC) -c $< $(CCFLAGS) -o $@



dgemm:
	$(MAKE) client_server -C $@ -f ../Makefile
pdgemm:
	$(MAKE) client_server -C $@ -f ../Makefile \
		BLASLIBS=$(PBLASLIBS) CC=mpicc


client_server:	client server

client:		client.o @PREFIX@/lib/libDIET_client.a
	$(CC) $< $(CCFLAGS) $(CLIENT_LIB) $(LIBS) -o $@

client.o:	client.c
	$(CC) -c $< $(CCFLAGS) -o $@

server:		server.o @PREFIX@/lib/libDIET_SeD.a
	$(CC) $< $(CCFLAGS) $(SED_LIB) $(LIBS) $(BLASLIBS) -o $@

server.o:	server.c
	$(CC) -c $< $(CCFLAGS) -o $@



clean:
	rm -f *.o BLAS_client
	$(MAKE) clean_subdir -C dgemm  -f ../Makefile
	$(MAKE) clean_subdir -C pdgemm -f ../Makefile

clean_subdir:
	rm -f *.o client server




