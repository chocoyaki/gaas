#****************************************************************************#
#* $Id$ *#
#* DIET examples BLAS Makefile                                              *#
#*                                                                          *#
#*  Author(s):                                                              *#
#*    - Philippe COMBES           - LIP ENS Lyon (France)                   *#
#*    - Romain   LACROIX          - LIP ENS Lyon (France)                   *#
#*                                                                          *#
#*  This is part of DIET software.                                          *#
#*  Copyright (C) 2002 ReMaP/LIFC/INRIA                                     *#
#*                                                                          *#
#****************************************************************************#
#*
#* $Log$
#* Revision 1.5  2002/10/03 17:58:16  pcombes
#* Add trace levels (for Bert): traceLevel = n can be added in cfg files.
#* An agent son can now be killed (^C) without crashing this agent.
#* DIET with FAST: compilation is OK, but run time is still to be fixed.
#*
#* Revision 1.4  2002/09/17 15:23:16  pcombes
#* Bug fixes on inout arguments and examples
#* Add support for omniORB 4.0.0
#*
#* Revision 1.3  2002/09/09 15:56:51  pcombes
#* Update for dgemm and bug fixes
#*
#* Revision 1.2  2002/08/09 14:30:32  pcombes
#* This is commit set the frame for version 1.0 - does not work properly yet
#*
#****************************************************************************#

TOP = ../../..
include $(TOP)/src/config.mk

BLASLIBS = -lm -lblacsCinit-mpich -lblacs-mpich -lblas \
	   -lscalapack-mpich -lm -lmpi -lg2c

DIETLIBS = -L@PREFIX@/lib

CC = gcc
INCLUDE = -I$(TOP)/include -I$(FASTTOP)/include
CCFLAGS = $(FASTFLAGS)
LIBS    = $(DIETLIBS) $(OMNIORBLIBS)


.PHONY: dgemm pdgemm clean

all:	BLAS_client dgemm pdgemm


BLAS_client:	BLAS_client.o @PREFIX@/lib/libDIET_client.a
	$(CC) $< $(CCFLAGS) $(LIBS) -lDIET_client -o $@

BLAS_client.o:	BLAS_client.c
	$(CC) -c $< $(CCFLAGS) $(INCLUDE) -o $@



dgemm:
	$(MAKE) client_server -C $@ -f ../Makefile TOP=../$(TOP)
pdgemm:
	$(MAKE) client_server -C $@ -f ../Makefile TOP=../$(TOP) CC=mpicc


client_server:	client server

client:		client.o @PREFIX@/lib/libDIET_client.a
	$(CC) $< $(CCFLAGS) $(LIBS) -lDIET_client -o $@

client.o:	client.c
	$(CC) -c $< $(CCFLAGS) $(INCLUDE) -o $@

server:		server.o @PREFIX@/lib/libDIET_SeD.a
	$(CC) $< $(CCFLAGS) $(LIBS) $(BLASLIBS) -lDIET_SeD $(FASTLIBS) -o $@

server.o:	server.c
	$(CC) -c $< $(CCFLAGS) $(INCLUDE) -o $@



clean:
	rm -f *.o BLAS_client
	$(MAKE) clean_subdir -C dgemm -f ../Makefile  TOP=../$(TOP)
	$(MAKE) clean_subdir -C pdgemm -f ../Makefile TOP=../$(TOP)

clean_subdir:
	rm -f *.o client server




