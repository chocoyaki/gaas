#****************************************************************************#
#* DIET ScaLAPACK example: Makefile                                         *#
#*                                                                          *#
#*  Author(s):                                                              *#
#*    - Philippe COMBES (Philippe.Combes@ens-lyon.fr)                       *#
#*    - Bert VAN HEUKELOM (Bert.VanHeukelom@ens-lyon.fr)                    *#
#*                                                                          *#
#* $LICENSE$                                                                *#
#****************************************************************************#
#* $Id$
#* $Log$
#* Revision 1.1  2003/09/26 14:07:01  pcombes
#* Get the examples out of the automake chain, to make Makefiles more readable.
#* The generated before.mk includes the right Makefile.inc.
#*
#****************************************************************************#

##
# The following lines are necessary to include this example in the
# configuration chain of DIET.
#
srcdir = @srcdir@
subdir = src/examples/ScaLAPACK
SOURCES = client.c job.c pdgemm_client.c server.c
HEADERS = job.h
#
# before.mk includes the right Makefile.inc. Indeed, the user might wish to
# compile this example without installing actually DIET ; thus we cannot assume
# that the Makefile.inc is really in $(prefix): if it is not installed, then we
# will look for it in the build directory.
# If we could be sure that Makefile.inc is installed before compiling this
# example, we would simply add the following line, which is what the user should
# do for his own examples: include $(prefix)/include/Makefile.inc
#
include ../before.mk
#
##

MPICC = mpicc
MPIFLAGS = -I/usr/include/lam

PROGRAMS = ScaL_client ScaL_server pdgemm_client

all: 	$(PROGRAMS)

pdgemm_client:	pdgemm_client.c $(DIET_CLIENT_PREREQ)
	$(CC) $(CCFLAGS_DIET) $< $(DIET_CLIENT_LIBS) -o $@

ScaL_client:	client.c $(DIET_CLIENT_PREREQ)
	$(CC) $(CCFLAGS_DIET) $< $(DIET_CLIENT_LIBS) -o $@

ScaL_server:	server.o job.o $(DIET_SERVER_BIN_PREREQ)
	$(MPICC) -o $@ $^ @LIBS_SCALAPACK@ $(DIET_SERVER_LIBS)

server.o:	server.c job.h $(DIET_SERVER_SRC_PREREQ)
	$(MPICC) -c $< @CCFLAGS_SCALAPACK@ $(CCFLAGS_DIET) $(MPIFLAGS) -o $@

job.o:		job.c
	$(CC) -c $(CCFLAGS_DIET) $(MPIFLAGS) job.c

