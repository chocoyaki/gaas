#****************************************************************************#
#* Common part of examples Makefiles:                                       *#
#*   included before anything else, but the setting of $(srcdir)            *#
#*                                                                          *#
#*  Author(s):                                                              *#
#*    - Philippe COMBES (Philippe.Combes@ens-lyon.fr)                       *#
#*                                                                          *#
#* $LICENSE$                                                                *#
#****************************************************************************#
#* $Id$
#* $Log$
#* Revision 1.2  2006/02/16 00:49:24  ecaron
#* Take into account relative path (avoid -L with space)
#*
#* Revision 1.1  2003/09/26 14:07:01  pcombes
#* Get the examples out of the automake chain, to make Makefiles more readable.
#* The generated before.mk includes the right Makefile.inc.
#*
#****************************************************************************#

prefix=@prefix@
inst_bindir = `cd ../bin; pwd`
top_builddir = ../../..
top_srcdir = $(srcdir)/../../..
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
DISTFILES = $(SOURCES) $(HEADERS) Makefile.in
VPATH = $(srcdir)

# include is the last directory to be installed
DIET_INSTALLED = $(shell if [ -f $(prefix)/include/Makefile.inc ]; then echo yes; fi)

ifeq ($(DIET_INSTALLED), yes)
MAKEFILE_INC = $(prefix)/include/Makefile.inc
else
DIET_INSTALLDIR = $(top_srcdir)
DIET_CLIENT_LIB = -L$(top_builddir)/src/client/.libs -lDIET_client
DIET_SED_LIB    = -L$(top_builddir)/src/SeD/.libs -lDIET_SeD
DIET_CLIENT_BIN_PREREQ = $(top_builddir)/src/client/libDIET_client.la
DIET_SERVER_BIN_PREREQ = $(top_builddir)/src/SeD/libDIET_SeD.la
MAKEFILE_INC = $(top_builddir)/include/Makefile.inc
endif


all:	$(MAKEFILE_INC) Makefile ../before.mk

ifeq ($(DIET_INSTALLED), yes)
INSTALL_HEADERS = && $(MAKE) install-includeHEADERS
endif

$(MAKEFILE_INC): @MAINTAINER_MODE_TRUE@ $(top_srcdir)/include/Makefile.inc.in	\
		 $(top_builddir)/config.status
	cd $(top_builddir) && 							\
	@SHELL@ ./config.status include/$(notdir $@) depfiles $(INSTALL_HEADERS)

Makefile:	@MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in	\
		$(top_builddir)/config.status
	cd $(top_builddir) && @SHELL@ ./config.status $(subdir)/$@ depfiles

../before.mk:	@MAINTAINER_MODE_TRUE@ $(srcdir)/../before.mk.in\
		$(top_builddir)/config.status
	cd $(top_builddir) && \
	@SHELL@ ./config.status $(dir $(subdir))$(notdir $@) depfiles


include $(MAKEFILE_INC)


clean:
	-rm -f *.o
	@list='$(PROGRAMS)'; for p in $$list; do \
	  f=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
	  if [ "$$f" != "$$p" ]; then \
	    echo " rm -f $$p $$f"; \
	    rm -f $$p $$f ; \
	  else \
	    echo " rm -f $$p"; \
	    rm -f $$p ; \
	  fi; \
	done

mostlyclean:

distclean: clean
	-rm -f Makefile

maintainer-clean:

##
# Distribution part: inspired from the Makefiles generated by automake-1.7.7
#

top_distdir = ../../..
distdir = $(top_distdir)/@PACKAGE@-@VERSION@

distdir: $(DISTFILES)
	$(mkinstalldirs) $(distdir)/../../..
	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
	list='$(DISTFILES)'; for file in $$list; do \
	  case $$file in \
	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
	  esac; \
	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
	    dir="/$$dir"; \
	    $(mkinstalldirs) "$(distdir)$$dir"; \
	  else \
	    dir=''; \
	  fi; \
	  if test -d $$d/$$file; then \
	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
	    fi; \
	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
	  else \
	    test -f $(distdir)/$$file \
	    || cp -p $$d/$$file $(distdir)/$$file \
	    || exit 1; \
	  fi; \
	done
#
##

##
# Install part: copy the binaries into src/examples/bin.
# If you should uncomment this part, make sure to alter the names of the
# binaries generated in each subdirectory (see the variable PROGRAMS of the
# corresponding Makefile.in) Indeed there is a "client" and a "server" in each
# examples, and this target copy all of them into one single directory.
#
# INSTALL = @INSTALL@
# 
install:	all
# 	$(mkinstalldirs) $(inst_bindir)
# 	@list='$(PROGRAMS)'; for p in $$list; do \
# 	  p1=`echo $$p|sed 's/@EXEEXT@$$//'`; \
# 	  if test -f $$p || test -f $$p1; then \
# 	    f=`echo "$$p1" | sed 's,^.*/,,;s,x,x,;s/$$/$(EXEEXT)/'`; \
# 	   echo " @LIBTOOL@ --mode=install @INSTALL_PROGRAM@ $$p $(inst_bindir)/$$f"; \
# 	   @LIBTOOL@ --mode=install @INSTALL_PROGRAM@ $$p $(inst_bindir)/$$f || exit 1; \
# 	  else :; fi; \
# 	done
#
##
